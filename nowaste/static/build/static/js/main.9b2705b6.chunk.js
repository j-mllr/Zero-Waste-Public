(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{26:function(e,t,a){},49:function(e,t,a){e.exports=a(90)},54:function(e,t,a){},90:function(e,t,a){"use strict";a.r(t);var s=a(0),n=a.n(s),r=a(22),o=a.n(r),i=(a(54),a(8)),c=a(9),l=a(11),p=a(10),d=a(12),u=(a(26),a(17)),m=a(2),h=a(13),v=a(45),f=a.n(v),y=a(16),g=["Donation","Second Hand","Repair","Reduced Packaging","Share"],b=function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(l.a)(this,Object(p.a)(t).call(this,e))).state={assetList:null,dropPin:!1,assetName:"",assetType:"",assetAddress:"",assetLong:"",assetLat:"",error:!1,errorMessage:""},a.getAddress=a.getAddress.bind(Object(m.a)(a)),a.pinDropped=a.pinDropped.bind(Object(m.a)(a)),a.validateForm=a.validateForm.bind(Object(m.a)(a)),a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"getAddress",value:function(e){var t=e.text.length;return e.place_name.slice(t+2)}},{key:"pinDropped",value:function(e){var t={type:"Feature",geometry:{type:"Point",coordinates:[e.lngLat.lng,e.lngLat.lat]}};!0===this.state.dropPin&&(this.props.map.getSource("single-point").setData(t),this.setState({assetLong:e.lngLat.lng}),this.setState({assetLat:e.lngLat.lat}))}},{key:"validateForm",value:function(e){""===this.state.assetName?(e.preventDefault(),this.setState({error:!0,errorMessage:"Please fill in the asset name"})):""===this.state.assetType?(e.preventDefault(),this.setState({error:!0,errorMessage:"Asset type is required"})):""!==this.state.assetLong&&""!==this.state.assetLat||(e.preventDefault(),this.setState({error:!0,errorMessage:"Please use the search or drop a pin"}))}},{key:"componentDidMount",value:function(){var e=this,t=this.props.map,a=new f.a({accessToken:"pk.eyJ1Ijoiam1pbGxhciIsImEiOiJjano5NnpiY2kwOXAzM2NsbzJrNmdzNnFtIn0.0wsjbxKPo2ngn-Q5D7H_DA"});"HOME"===this.props.lastPage?this.props.map.loaded()?this.removeHomeMapStyles(t):setTimeout(function(){console.log("Map not loaded - delay"),e.removeHomeMapStyles(t)},1500):t.on("load",function(){console.log("on create load"),t.addSource("single-point",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),t.addLayer({id:"point",type:"symbol",source:"single-point",layout:{"icon-image":"marker-15","icon-size":1.5}}),t.addSource("locations",{type:"geojson",data:e.state.assetList})}),t.addControl(a),a.on("result",function(a){t.getSource("single-point").setData(a.result.geometry),e.setState({assetName:a.result.text,assetAddress:e.getAddress(a.result),assetLong:a.result.geometry.coordinates[0],assetLat:a.result.geometry.coordinates[1],dropPin:!1})}),t.on("click",this.pinDropped),this.props.dispatch({type:"ON_CREATE",data:a,function:this.pinDropped})}},{key:"removeHomeMapStyles",value:function(e){for(var t=0,a=g;t<a.length;t++){var s=a[t];e.off("click","poi-"+s,this.props.removeableFunction),e.getLayer("poi-"+s)&&e.removeLayer("poi-"+s)}this.props.assetList.features.length>0&&(e.removeSource("locations"),e.addSource("locations",{type:"geojson",data:this.state.assetList})),e.addSource("single-point",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),e.addLayer({id:"point",type:"symbol",source:"single-point",layout:{"icon-image":"marker-15","icon-size":1.5}})}},{key:"render",value:function(){var e=this,t="";return this.state.error&&(t=this.state.errorMessage),n.a.createElement(n.a.Fragment,null,n.a.createElement("div",{id:"mainHeader"},"Zero Waste Asset Map",n.a.createElement("div",{id:"navigation"},n.a.createElement("nav",null,n.a.createElement("div",{id:"home"}," ",n.a.createElement(h.b,{to:"/"},"Home")," "),n.a.createElement("div",{id:"create"}," ",n.a.createElement(h.b,{to:"/create"},"Create "))))),n.a.createElement("div",{id:"appContainer"},n.a.createElement("div",{id:"content"},n.a.createElement("div",null,n.a.createElement("h1",{id:"createHeader"},"Add an asset")),n.a.createElement("div",{id:"errorMessage"}," ",t," "),n.a.createElement("form",{method:"post"},n.a.createElement("div",{id:"assetBoxes"},n.a.createElement("label",{id:"nameLabel",htmlFor:"asset_name"},"Asset Name"),n.a.createElement("input",{name:"asset_name",id:"asset_name",value:this.state.assetName,onChange:function(t){return e.setState({assetName:t.target.value})},required:!0}),n.a.createElement("label",{id:"typeLabel",htmlFor:"asset_type"},"Asset Type"),n.a.createElement("select",{name:"asset_type",defaultValue:"Default",onChange:function(t){e.setState({assetType:t.target.value})},required:!0},n.a.createElement("option",{disabled:!0,value:"Default"},"-- Select a type --"),n.a.createElement("option",{value:"Donation"},"Donation"),n.a.createElement("option",{value:"Repair"},"Repair"),n.a.createElement("option",{value:"Reduced Packaging"},"Reduced Packaging"),n.a.createElement("option",{value:"Second Hand"},"Second-Hand"),n.a.createElement("option",{value:"Share"},"Share")),n.a.createElement("label",{id:"addressLabel",htmlFor:"asset_address"},"Address"),n.a.createElement("textarea",{name:"asset_address",id:"asset_address",value:this.state.assetAddress,onChange:function(t){return e.setState({assetAddress:t.target.value})}}),n.a.createElement("input",{type:"hidden",name:"latitude",id:"latitude",value:this.state.assetLat,onChange:function(t){return e.setState({assetLat:t.target.value})}}),n.a.createElement("input",{type:"hidden",name:"longitude",id:"longitude",value:this.state.assetLong,onChange:function(t){return e.setState({assetLong:t.target.value})}}),n.a.createElement("input",{id:"submitButton",type:"submit",value:"Submit",onClick:function(t){return e.validateForm(t)}}),n.a.createElement("button",{type:"button",id:"dropPin",onClick:function(t){return e.setState({dropPin:!0,assetLat:"",assetLong:"",assetAddress:""})}}," ","Drop pin"," "))))))}}]),t}(n.a.Component),E=Object(y.b)(function(e,t){return{assetList:e.assetList,isGeocoderVisible:e.geocoder,lastPage:e.lastPage,removeableFunction:e.removeableFunction}})(b),A=a(19),L=a.n(A),j=function(e){function t(){return Object(i.a)(this,t),Object(l.a)(this,Object(p.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this;return n.a.createElement(n.a.Fragment,null,n.a.createElement(S,{stateHandler:this.props.stateHandler,plotAssets:this.props.plotAssets}),n.a.createElement("div",{id:"assetList"},n.a.createElement("div",{className:"assets"},!this.props.assetList.features.length>0&&"CREATE"!==this.props.lastPage&&n.a.createElement("div",null,"No assets found"),this.props.assetList.features.map(function(t){return n.a.createElement(O,{chosenAsset:t===e.props.chosenAsset?{color:"red"}:{color:"black"},updateChosenAsset:e.props.updateChosenAsset,asset:t,key:t.properties.id,name:t.properties.asset_name,updateIdToRefMap:e.props.updateIdToRefMap})}))))}}]),t}(n.a.Component),O=function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(l.a)(this,Object(p.a)(t).call(this,e))).myRef=n.a.createRef(),a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.props.updateIdToRefMap(this.props.asset,this.myRef)}},{key:"render",value:function(){var e=this;return n.a.createElement("a",{ref:this.myRef,style:this.props.chosenAsset,onClick:function(t){e.props.updateChosenAsset(e.props.asset,e.myRef)},id:this.props.id},this.props.name)}}]),t}(n.a.Component),S=function(e){function t(){var e,a;Object(i.a)(this,t);for(var s=arguments.length,n=new Array(s),r=0;r<s;r++)n[r]=arguments[r];return(a=Object(l.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(n)))).state={searchTerm:""},a.handleSubmit=function(e){e.preventDefault(),a.getData(a.props.stateHandler)},a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"getData",value:function(e){fetch("/geojson/"+this.state.searchTerm).then(function(e){return e.json()}).then(function(t){e(t)})}},{key:"render",value:function(){var e=this;return n.a.createElement("div",{id:"stickyHeader"},n.a.createElement("h1",{id:"assets"},"Assets",n.a.createElement("form",{id:"searchForm",onSubmit:this.handleSubmit},n.a.createElement("input",{id:"searchInput",placeholder:"Search...",type:"text",name:"name",onChange:function(t){return e.setState({searchTerm:t.target.value})}}))))}}]),t}(n.a.Component),k={Donation:"#0D7FFF","Second Hand":"#FFBE2A",Repair:"#E700FF","Reduced Packaging":"#009393",Share:"#FF3919"},P=function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(l.a)(this,Object(p.a)(t).call(this,e))).state={assetList:a.props.assetList,chosenId:null,chosenAsset:null,assetLayerTypes:new Set,idToRefMap:new Map},a.updateAssetList=a.updateAssetList.bind(Object(m.a)(a)),a.updateChosenAsset=a.updateChosenAsset.bind(Object(m.a)(a)),a.setAsset=a.setAsset.bind(Object(m.a)(a)),a.plotAssets=a.plotAssets.bind(Object(m.a)(a)),a.updateMapAssets=a.updateMapAssets.bind(Object(m.a)(a)),a.createPopUp=a.createPopUp.bind(Object(m.a)(a)),a.updateIdToRefMap=a.updateIdToRefMap.bind(Object(m.a)(a)),a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"closePopUp",value:function(){var e=document.getElementsByClassName("mapboxgl-popup");e[0]&&e[0].remove()}},{key:"flyToAsset",value:function(e){this.closePopUp(),this.props.map.flyTo({center:e.geometry.coordinates.slice(),zoom:15})}},{key:"createPopUp",value:function(e){var t=this.props.map,a=e.features[0].geometry.coordinates.slice(),s=e.features[0].properties,n=s.id,r=s.asset_name,o=s.asset_type,i=s.address,c=(s.postal_code,"");c="ReducedPackaging"===o?"<data class="+n+"></data><div class=popName>"+r+"</div><div class=infoGrid> <div class=popAddressLabel> Address: </div>  <div class=popAddress>"+i+"</div><div class=typeLabel> Type: </div> <div class=type> Reduced Packaging </div> </div>":"SecondHand"===o?"<data class="+n+"></data><div class=popName>"+r+"</div><div class=infoGrid> <div class=popAddressLabel> Address: </div>  <div class=popAddress>"+i+"</div><div class=typeLabel> Type: </div> <div class=type>  Second Hand </div> </div>":"<data class="+n+"></data><div class=popName>"+r+"</div><div class=infoGrid> <div class=popAddressLabel> Address: </div>  <div class=popAddress>"+i+"</div><div class=typeLabel> Type: </div> <div class=type>"+o+"</div> </div>",(new L.a.Popup).setLngLat(a).setHTML(c).addTo(t);var l=this.state.assetList.features.find(function(e){return n===e.properties.id});this.state.idToRefMap.get(l.properties.id).current.scrollIntoView({behavior:"smooth",block:"nearest"}),this.setState({chosenAsset:l})}},{key:"updateMapAssets",value:function(){var e=this.props.map,t=!0,a=!1,s=void 0;try{for(var n,r=this.state.assetLayerTypes[Symbol.iterator]();!(t=(n=r.next()).done);t=!0){var o=n.value;e.off("click","poi-"+o,this.createPopUp),e.removeLayer("poi-"+o)}}catch(h){a=!0,s=h}finally{try{t||null==r.return||r.return()}finally{if(a)throw s}}e.removeSource("locations"),e.addSource("locations",{type:"geojson",data:this.state.assetList});var i=new Set;this.state.assetList.features.map(function(t){var a=t.properties.asset_type,s="poi-"+a;i.add(a),e.getLayer(s)||e.addLayer({id:s,source:"locations",type:"circle",paint:{"circle-radius":8,"circle-color":k[a]},filter:["==","asset_type",a]})}),this.setState({assetLayerTypes:i});var c=!0,l=!1,p=void 0;try{for(var d,u=i[Symbol.iterator]();!(c=(d=u.next()).done);c=!0){var m="poi-"+d.value;e.on("click",m,this.createPopUp)}}catch(h){l=!0,p=h}finally{try{c||null==u.return||u.return()}finally{if(l)throw p}}}},{key:"plotAssets",value:function(){var e=this,t=this.props.map;t.on("load",function(){t.addSource("locations",{type:"geojson",data:e.state.assetList});var a=new Set;e.state.assetList.features.map(function(e){var s=e.properties.asset_type,n="poi-"+s;a.add(s),t.getLayer(n)||t.addLayer({id:n,source:"locations",type:"circle",paint:{"circle-radius":8,"circle-color":k[s]},filter:["==","asset_type",s]})}),e.setState({assetLayerTypes:a});var s=!0,n=!1,r=void 0;try{for(var o,i=a[Symbol.iterator]();!(s=(o=i.next()).done);s=!0){var c="poi-"+o.value;t.on("click",c,e.createPopUp)}}catch(l){n=!0,r=l}finally{try{s||null==i.return||i.return()}finally{if(n)throw r}}})}},{key:"updateChosenAsset",value:function(e){this.setState({chosenId:e})}},{key:"updateIdToRefMap",value:function(e,t){var a=this.state.idToRefMap;a.set(e.properties.id,t),this.setState({idToRefMap:a})}},{key:"setAsset",value:function(e,t){this.setState({chosenAsset:e}),this.flyToAsset(e)}},{key:"updateAssetList",value:function(e){this.props.dispatch({type:"UPDATE_ASSETS",data:e,function:this.createPopUp})}},{key:"getData",value:function(){var e=this;fetch("/geojson").then(function(e){return e.json()}).then(function(t){e.props.dispatch({type:"UPDATE_ASSETS",data:t,function:e.createPopUp})}).catch(function(e){console.log(e)})}},{key:"componentWillReceiveProps",value:function(e){var t=this.props;t.assetList!==e.assetList&&("NONE"===t.lastPage?this.setState({assetList:e.assetList},this.plotAssets):this.setState({assetList:e.assetList},this.updateMapAssets))}},{key:"componentDidMount",value:function(){var e=this;"CREATE"===this.props.lastPage?this.props.map.loaded()?this.removeCreateMapStyles():setTimeout(function(){console.log("Map not loaded - delay"),e.removeCreateMapStyles()},1e3):"NONE"===this.props.lastPage?this.getData():"HOME"===this.props.lastPage&&this.updateMapAssets()}},{key:"removeCreateMapStyles",value:function(){this.props.map.removeControl(this.props.isGeocoderVisible),this.props.map.off("click",this.props.removeableFunction),this.props.map.removeLayer("point"),this.props.map.removeSource("single-point"),this.getData()}},{key:"render",value:function(){return n.a.createElement(n.a.Fragment,null,n.a.createElement("div",{id:"mainHeader"},"Zero Waste Asset Map",n.a.createElement("div",{id:"navigation"},n.a.createElement("nav",null,n.a.createElement("div",{id:"home"}," ",n.a.createElement(h.b,{to:"/"},"Home")," "),n.a.createElement("div",{id:"create"}," ",n.a.createElement(h.b,{to:"/create"},"Create "))))),n.a.createElement("div",{id:"appContainer"},n.a.createElement("div",{id:"content"},n.a.createElement(j,{stateHandler:this.updateAssetList,updateChosenAsset:this.setAsset,chosenAsset:this.state.chosenAsset,assetList:this.props.assetList,plotAssets:this.plotAssets,updateIdToRefMap:this.updateIdToRefMap,lastPage:this.props.lastPage}))))}}]),t}(n.a.Component),T=Object(y.b)(function(e,t){return{assetList:e.assetList,isGeocoderVisible:e.geocoder,lastPage:e.lastPage,removeableFunction:e.removeableFunction}})(P),M=function(e){function t(){return Object(i.a)(this,t),Object(l.a)(this,Object(p.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return n.a.createElement(n.a.Fragment,null,n.a.createElement(D,{map:this.props.map}))}}]),t}(n.a.Component),C=Object(y.b)(function(e,t){return{assetList:e.assetList,isGeocoderVisible:e.geocoder}})(M),D=function(e){return n.a.createElement(u.c,null,n.a.createElement(u.a,{exact:!0,path:"/",render:function(t){return n.a.createElement(T,{map:e.map})}}),n.a.createElement(u.a,{exact:!0,path:"/create",render:function(t){return n.a.createElement(E,{map:e.map})}}))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var F=a(48),w=a(24);function R(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,s)}return a}function N(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?R(a,!0).forEach(function(t){Object(F.a)(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):R(a).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}var H={type:"FeatureCollection",features:[]};fetch("/geojson").then(function(e){return e.json()}).then(function(e){H=e}).catch(function(e){console.log(e)});var _={assetList:H,geocoder:null,lastPage:"NONE",removeableFunction:null};var I=Object(w.b)(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:_,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"ON_CREATE":return N({},e,{assetList:{type:"FeatureCollection",features:[]},geocoder:t.data,lastPage:"CREATE",removeableFunction:t.function});case"UPDATE_ASSETS":return N({},e,{assetList:t.data,geocoder:null,lastPage:"HOME",removeableFunction:t.function});default:return e}});L.a.accessToken="pk.eyJ1Ijoiam1pbGxhciIsImEiOiJjano5NnpiY2kwOXAzM2NsbzJrNmdzNnFtIn0.0wsjbxKPo2ngn-Q5D7H_DA";var x=new L.a.Map({container:"map",style:"mapbox://styles/mapbox/light-v9",center:[-123.1126,49.2418],zoom:11});o.a.render(n.a.createElement(y.a,{store:I},n.a.createElement(h.a,null,n.a.createElement(C,{map:x}))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[49,1,2]]]);
//# sourceMappingURL=main.9b2705b6.chunk.js.map